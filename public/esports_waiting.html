<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÂæÖÊ©üÁîªÈù¢</title>
    <style>
      @keyframes gradientMove {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Orbitron", sans-serif;
        color: #fff;
        overflow: hidden;
        background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
        background-size: 300% 300%;
        animation: cover;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .background-effect {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -2;
      }

      .particle {
        position: absolute;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        animation: moveParticles 10s linear infinite;
      }

      @keyframes moveParticles {
        from {
          transform: translateY(100vh) translateX(0);
          opacity: 1;
        }
        to {
          transform: translateY(-10vh) translateX(10vw);
          opacity: 0;
        }
      }

      #timer {
        position: absolute;
        top: 5%;
        left: 5%;
        font-size: 6vw;
        font-weight: bold;
      }

      #match-info {
        position: absolute;
        top: 5%;
        right: 5%;
        font-size: 2vw;
        text-align: right;
      }

      #slideshow-container {
        position: absolute;
        bottom: 3%;
        left: 3%;
        width: 50vw;
        height: 15vw;
        overflow: hidden;
        border-radius: 10px;
        border: 2px solid #fff;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1.5s ease-in-out;
        background-size: cover;
        background-position: center;
      }

      .active {
        opacity: 1 !important;
      }
    </style>
  </head>
  <body>
    <!-- ËÉåÊôØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ -->
    <div class="background-effect" id="particle-container"></div>

    <!-- „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„Çø„Ç§„Éû„Éº -->
    <div id="timer">00:00:00</div>

    <!-- Ë©¶ÂêàÊÉÖÂ†±„Ç®„É™„Ç¢ -->
    <div id="match-info">
      <h2 id="match-title">„Çø„Ç§„Éà„É´</h2>
      <p id="match-detail"></p>
    </div>

    <!-- „Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº -->
    <div id="slideshow-container"></div>

    <script>
      let slideshowInterval;

      async function loadSettings() {
        try {
          let response = await fetch("/get-settings");
          if (!response.ok) throw new Error("Ë®≠ÂÆö„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü");

          let settings = await response.json();
          console.log("üöÄ „Çµ„Éº„Éê„Éº„Åã„ÇâË®≠ÂÆö„Éá„Éº„Çø„Çí„É≠„Éº„Éâ:", settings);

          // ËÉåÊôØÁîªÂÉè„ÅÆÈÅ©Áî®
          applyBackground(settings.bgUrl);

          //Ë©¶ÂêàÊÉÖÂ†±„ÅÆÊõ¥Êñ∞
          document.getElementById("match-title").innerText =
            settings.matchTitle || "„Çø„Ç§„Éà„É´";
          document.getElementById("match-detail").innerText =
            settings.matchDetail || "";

          //„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„Çø„Ç§„Éû„Éº„ÅÆÊõ¥Êñ∞
          updateTimer(settings.startTime || "00:00");

          //„Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº„ÅÆÊõ¥Êñ∞
          updateSlideshow(settings.slideImages || []);

          //ÊñáÂ≠óËâ≤„ÅÆÈÅ©Áî®ÔºàÊñ∞Ë¶èËøΩÂä†Ôºâ
          if (settings.titleColor) {
            document.getElementById("match-title").style.color =
              settings.titleColor;
          }
          if (settings.detailColor) {
            document.getElementById("match-detail").style.color =
              settings.detailColor;
          }
          if (settings.timeColor) {
            document.getElementById("timer").style.color = settings.timeColor;
          }
        } catch (error) {
          console.error("Ë®≠ÂÆö„Éá„Éº„Çø„ÅÆ„É≠„Éº„Éâ„Å´Â§±Êïó:", error);
        }
      }

      // ËÉåÊôØÁîªÂÉè„ÇíÈÅ©Áî®
      function applyBackground(bgUrl) {
        let existingBackground = document.getElementById("background-element");
        let particleContainer = document.getElementById("particle-container");

        if (bgUrl) {
          console.log("ËÉåÊôØÁîªÂÉè„ÇíÈÅ©Áî®:", bgUrl);

          // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÂâäÈô§
          if (particleContainer) particleContainer.remove();
          if (existingBackground) existingBackground.remove();

          let isVideo =
            bgUrl.endsWith(".mp4") || bgUrl.startsWith("data:video/");

          if (isVideo) {
            let backgroundElement = document.createElement("video");
            backgroundElement.id = "background-element";
            backgroundElement.src = bgUrl;
            backgroundElement.style.position = "absolute";
            backgroundElement.style.top = "0";
            backgroundElement.style.left = "0";
            backgroundElement.style.width = "100%";
            backgroundElement.style.height = "100%";
            backgroundElement.style.objectFit = "cover";
            backgroundElement.style.zIndex = "-1";
            backgroundElement.autoplay = true;
            backgroundElement.loop = true;
            backgroundElement.muted = true;
            document.body.insertBefore(
              backgroundElement,
              document.body.firstChild
            );
          } else {
            document.body.style.background = `url(${bgUrl}) no-repeat center center fixed`;
            document.body.style.backgroundSize = "cover";
          }
        } else {
          console.log(
            "ËÉåÊôØÁîªÂÉè„ÅåÊú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅ„ÄÅ„Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà„ÇíÈÅ©Áî®"
          );
          if (!particleContainer) {
            let newParticleContainer = document.createElement("div");
            newParticleContainer.id = "particle-container";
            newParticleContainer.classList.add("background-effect");
            document.body.insertBefore(
              newParticleContainer,
              document.body.firstChild
            );
            createParticleEffect();
          }
        }
      }

      // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„Çø„Ç§„Éû„Éº„ÅÆÊõ¥Êñ∞
      function updateTimer(startTime) {
        function update() {
          let now = new Date();
          let start = new Date();
          let [hours, minutes] = startTime.split(":").map(Number);
          start.setHours(hours, minutes, 0, 0);
          let diff = Math.floor((start - now) / 1000);

          let h = Math.max(Math.floor(diff / 3600), 0);
          let m = Math.max(Math.floor((diff % 3600) / 60), 0);
          let s = Math.max(diff % 60, 0);

          document.getElementById("timer").innerText = `${String(h).padStart(
            2,
            "0"
          )}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
          setTimeout(update, 1000);
        }
        update();
      }

      // „Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº„ÅÆÊõ¥Êñ∞
      function updateSlideshow(slideImages) {
        let slideshowContainer = document.getElementById("slideshow-container");
        slideshowContainer.innerHTML = "";

        if (slideImages.length === 0) {
          console.warn("‚ö† „Çπ„É©„Ç§„Éâ„Ç∑„Éß„ÉºÁîªÂÉè„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì");
          return;
        }

        console.log("üì∏ „Çπ„É©„Ç§„Éâ„Ç∑„Éß„ÉºÁîªÂÉè„É™„Çπ„Éà:", slideImages);

        slideImages.forEach((src, index) => {
          let slide = document.createElement("div");
          slide.classList.add("slide");
          slide.style.backgroundImage = `url(${src})`;
          if (index === 0) slide.classList.add("active");
          slideshowContainer.appendChild(slide);
        });

        let slides = document.querySelectorAll(".slide");
        let currentSlide = 0;

        function changeSlide() {
          slides[currentSlide].classList.remove("active");
          currentSlide = (currentSlide + 1) % slides.length;
          slides[currentSlide].classList.add("active");
        }

        clearInterval(slideshowInterval);
        slideshowInterval = setInterval(changeSlide, 5000);
      }

      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç®„Éï„Çß„ÇØ„Éà„ÅÆ‰ΩúÊàê
      function createParticleEffect() {
        const particleContainer = document.getElementById("particle-container");
        for (let i = 0; i < 50; i++) {
          let particle = document.createElement("div");
          particle.classList.add("particle");
          particle.style.left = `${Math.random() * 100}vw`;
          particle.style.animationDuration = `${Math.random() * 5 + 5}s`;
          particleContainer.appendChild(particle);
        }
      }

      // Ë®≠ÂÆö„Éá„Éº„Çø„ÅÆ„É≠„Éº„Éâ
      loadSettings();
    </script>
  </body>
</html>
